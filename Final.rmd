---
title: "Covid91 vaccine study Final2024"
author: "Quintin Burnett"
output: 
  html_document:
    number_sections: true
    toc: true
    toc_depth: 5
date: "`r Sys.Date()`" 
---

```{r include=FALSE,echo=FALSE}
require(tidyverse)
require(tigerstats)
require(forcats)
OldData <-read.csv(file="finalSumr2024.csv",header=TRUE)
#recode to remove the annoying "X" from the dataframe
FinalData <- OldData %>% mutate(infected = recode(infected, covid19 = "covid", none = "OK" )) %>% select(-one_of("X"))
FinalData <- FinalData %>%
mutate(across(where(is.character), as.factor))
FinalData$treatment <- relevel(FinalData$treatment,ref="placebo")
#FinalData$infected <- relevel(FinalData$infected,ref="OK")
Male = filter(FinalData, sex =="M")
Female = filter(FinalData, sex =="F")
Gay = filter(FinalData, LGBTQ =="gay")
DrugUser = filter(FinalData, DrugUser =="yes")
```

# Introduction

A new preventative vaccine (covid921) is under test in clinical trials. Given the nature of this vaccine it is suspected that the drug may exhibit different effectiveness across the variety of subpopulations tracked. Consider population subgroups by gender( guys and gals), drug use, and sexual orientation. Write a complete report that separately considers this drug for each subgroup and your recommendations as to whether people in the subgroup should take the vaccine. Structure your report in four sections each devoted to one of the four subgroups, use null and alternative hypothesis statements and correct statistical verbage when referencing p-values in conclusions.


## Overall approach

1. **Descriptive Analysis**: Summarize data visually then numerically.
2. **Inferential Analysis**: Conduct hypothesis testing:
   - \(H_0\): The vaccine has no impact on infection rates.
   - \(H_A\): The vaccine reduces infection rates.
3. **Effectiveness Calculation**:
   \[
   \text{Vaccine Effectiveness (VE)} = 1 - \frac{\text{Risk}_{\text{vaccine}}}{\text{Risk}_{\text{placebo}}}
   \]
4. **Effectivness Confidence Interval**: low to hi
   
## Males

### Summary of Males
```{r}
male_summary <- Male %>%
  group_by(treatment, infected) %>%
  summarise(count = n(), .groups = "drop") %>%
  pivot_wider(names_from = infected, values_from = count, values_fill = 0)
male_summary <- male_summary %>%
  mutate(total = rowSums(select(., -treatment)))
male_column_totals <- male_summary %>%
  summarise(across(where(is.numeric), sum)) %>%
  mutate(treatment = "Total")
male_summary <- bind_rows(male_summary, male_column_totals)
male_summary
```

This is the given information so far for the males. There are 18392 males. 355 have covid while 18037 are OK. This isn't enough to show a trend so now let us add a barplot for a visual representation.

### Visual Results

```{r}
# Bar plot

# Summarize the data for Males by infection status and treatment
male_summary_data <- Male %>%
  group_by(infected, treatment) %>%
  summarize(count = n(), .groups = "drop") %>%
  mutate(prcnt = count / sum(count))

# Bar plot for count of infected vs treatment
male_plot_count <- ggplot(male_summary_data, aes(x = infected, y = count, fill = treatment))
male_plot_count + 
  geom_bar(stat = "identity", position = "dodge") +
  labs(title = "Number of Males Infected by Treatment",
       x = "Infection Status", y = "Count of Infected Males") +
  scale_fill_manual(values = c("placebo" = "gray", "vaccine" = "blue")) +
  theme_minimal()

# Bar plot for percentage of infected vs treatment
male_plot_percent <- ggplot(male_summary_data, aes(x = infected, y = prcnt * 100, fill = treatment))
male_plot_percent + 
  geom_bar(stat = "identity", position = "dodge") +
  labs(title = "Percentage of Males Infected by Treatment",
       x = "Infection Status", y = "Percentage of Infected Males") +
  scale_fill_manual(values = c("placebo" = "gray", "vaccine" = "blue")) +
  theme_minimal()
```

The Barplots above shows the number of males infected with covid. Visually males who take the vaccine have less covid than the placebo but the results are similarly close to the placebo on both graphs. Visually they are still different but we need to conduct a statistical analysis to confirm if the difference significant.

### Numerical Results
```{r}
table1 <- xtabs(~infected + treatment, data=Male)
rowPerc(table1)
colPerc(table1)
```

The numerical results show that in the infected males, **73.8%** had taken the placebo, while **26.2%** had taken the vaccine. For those who are OK, **50.01%** had taken the placebo, and **49.99%** had taken the vaccine. Overall, **2.82%** of males on the placebo have covid compared to **1.02%** on the vaccine, indicating that the vaccine reduces infection rates. These findings suggest the vaccine is effective in lowering covid with the males. With this we can coorelate this to the barplots proving the effectiveness.

### Inferential Results
```{r}
chisq.test(table1)
chisqtestGC(table1)
Malefish <- fisher.test(table1)
Malefish
```

The key result to focus on is Fisher's Exact Test, where the p-value is extremely small (\(p < 2.2 \times 10^{-16}\)) or **0.00000000000000022**. This means the observed differences in infection rates between the vaccine and placebo groups are very unlikely to occur by chance. The null hypothesis, which assumes infection rates are independent of treatment, is rejected. The odds ratio of about **2.82** shows that males who received the vaccine were nearly **2.8** times more likely to get covid compared to those who received the placebo. These results indicate the vaccine is not effective at preventing covid in males.

```{r}
# Calculate effectiveness
male_effect <- Malefish$p.value / (Malefish$p.value + 1)
effectiveness_male <- (1 - 1 / Malefish$estimate) * 100
print(effectiveness_male)

# Calculate effectiveness confidence interval
male_low <- (1 - 1 / Malefish$conf.int[1]) * 100
male_hi <- (1 - 1 / Malefish$conf.int[2]) * 100
options(digits = 2)

#print 
male_low
male_hi
```

### `r effectiveness_male`% Effectiveness with Confidence Interval: `r male_low`%  to `r male_hi`%

Above is the effectiveness of the covid vaccine for males. If the vaccine's effectiveness is above **50%**, it indicates that the vaccine is effective. Based on the calculated effectiveness of **64.48%** and the confidence interval ranging from **54.75%** to **72.32%**, we can conclude that the vaccine is effective in reducing infection rates among males.

The null hypothesis (\(H_0\)) assumed that the vaccine has no impact on infection rates, while the alternative hypothesis (\(H_A\)) posited that the vaccine reduces infection rates. Given the very small p-value from Fisherâ€™s Exact Test and the calculated odds ratio of **2.82**, we reject the null hypothesis and accept the alternative, confirming that the vaccine does reduce infection rates in males.

The odds ratio indicates that males who received the vaccine were nearly **2.8** times more likely to avoid contracting covid compared to those who received the placebo. The confidence interval further supports this, showing a **95%** range of effectiveness between **54.75%**% and **72.32%**, reinforcing the vaccine's significant protective effect.

## Females

### Summary of Females



### Visual Results



### Numerical Results



### Inferential Results



### Effectivness Results: low to high



## LGBTQ

### Summary of LGBTQ



### Visual Results



### Numerical Results



### Inferential Results



### Effectivness Results: low to high



## Druggies

### Summary of Druggies



### Visual Results



### Numerical Results



### Inferential Results



### Effectivness Results: low to high



# Overall Results and Conclusions